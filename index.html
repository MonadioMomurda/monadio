<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Monadio Momurda Cartel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    html, body { height: 100%; overflow-x: hidden; }

    body {
      min-height: 100vh;
      background: #000 url("bg.png") center center / cover fixed no-repeat;
      font-family: "JetBrains Mono","Fira Code","SF Mono","Roboto Mono",monospace;
      color: #fff;
    }

    /* ---------- HERO ---------- */

    .hero-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      padding-inline: 1rem;
      width: 100%;
    }

    .hero {
      position: relative;
      height: 100vh;
      max-width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .hero-img {
      height: 100%;
      width: auto;
      max-width: 100%;
      display: block;
      mix-blend-mode: screen; /* make main.png blend with bg using SCREEN */
    }

    .nav-links {
      position: absolute;
      left: 10%;
      bottom: 14%;
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
      z-index: 5;
    }

    .nav-links a {
      text-decoration: none;
      font-size: 4.5rem;
      font-weight: 700;
      color: rgba(202,160,255,0.95);
      letter-spacing: 0.06em;
      text-shadow:
        0 0 10px #b154ff,
        0 0 22px #a442ff,
        0 0 36px #9025ff;
      transition: transform .15s ease, text-shadow .15s ease;
    }

    .nav-links a::before {
      content: "> ";
    }

    .nav-links a:hover {
      transform: translateX(8px);
      text-shadow:
        0 0 12px #b154ff,
        0 0 26px #a442ff,
        0 0 42px #9025ff,
        0 0 60px #7a0aff;
    }

    /* ---------- RESPONSIVE HERO ---------- */

    @media (max-width: 900px) {
      .hero { height: auto; width: 100vw; display: block; }
      .hero-img { width: 100vw; height: auto; }

      .nav-links { left: 8%; bottom: 8%; gap: 0.9rem; }
      .nav-links a { font-size: 2.4rem; }
    }

    @media (max-width: 600px) {
      .nav-links { left: 7%; bottom: 6%; gap: 0.7rem; }
      .nav-links a { font-size: 2rem; }
    }

    /* ---------- MINT POPUP ---------- */

    .mint-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(3px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .mint-popup {
      width: 92%;
      max-width: 480px;
      background: #050505;
      border-radius: 12px;
      border: 2px solid rgba(202,160,255,0.5);
      box-shadow:
        0 0 30px rgba(202,160,255,0.7),
        0 0 60px rgba(100,40,150,0.8);
      padding: 2rem;
      position: relative;
      text-align: center;
    }

    .popup-title {
      font-size: 2rem;
      letter-spacing: 0.15em;
      color: #f7e8ff;
      margin-bottom: 0.6rem;
    }

    .popup-sub {
      font-size: 0.9rem;
      opacity: 0.8;
      margin-bottom: 2rem;
    }

    .close-popup {
      position: absolute;
      top: 12px;
      right: 16px;
      font-size: 1.6rem;
      cursor: pointer;
      color: #d9b3ff;
      text-shadow: 0 0 10px rgba(202,160,255,1);
    }

    .popup-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.3rem;
    }

    .popup-label {
      font-size: 1rem;
      letter-spacing: .08em;
    }

    .amount-controls {
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    .amount-btn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 1px solid rgba(200,150,255,0.9);
      background: transparent;
      color: #e6d1ff;
      cursor: pointer;
      font-size: 1.3rem;
      transition: 0.1s ease;
    }

    .amount-btn:hover {
      background: rgba(200,150,255,0.18);
      transform: translateY(-1px);
    }

    .amount-value {
      min-width: 34px;
      text-align: center;
      font-size: 1.3rem;
    }

    .button-primary {
      width: 100%;
      border-radius: 999px;
      padding: 0.9rem;
      border: 1px solid rgba(200,150,255,0.9);
      background: linear-gradient(135deg,#b365ff,#ff9dff);
      color: #100017;
      font-weight: 700;
      letter-spacing: 0.12em;
      cursor: pointer;
      text-transform: uppercase;
      box-shadow: 0 0 16px rgba(200,150,255,0.35);
      margin-top: 0.7rem;
      font-size: 0.86rem;
    }

    .button-primary:disabled {
      opacity: 0.4;
      cursor: default;
      box-shadow: none;
    }

    .connect-btn {
      background: transparent;
      color: #d9c0ff;
    }

    .wl-btn {
      background: #120019;
      border-style: dashed;
      color: #f5d8ff !important; /* MAKE IT VISIBLE */
      text-shadow:
        0 0 10px #b154ff,
        0 0 20px #a442ff;
    }

    .mint-status {
      margin-top: 1rem;
      min-height: 1.2rem;
      font-size: 0.85rem;
    }

    .mint-status.error   { color: #ff8f9a; }
    .mint-status.success { color: #9bffb5; }

    .contract-line {
      margin-top: 0.6rem;
      font-size: 0.75rem;
      opacity: 0.75;
    }

    .contract-line a {
      color: #caa0ff;
      text-decoration: underline;
    }
  </style>
</head>

<body>

<!-- HERO -->
<section class="hero-wrapper">
  <div class="hero">
    <img src="main.png" class="hero-img" alt="Monadio Momurda Cartel">

    <nav class="nav-links">
      <a href="#" id="openMint">MINT</a>
      <a href="https://x.com/MonadioMomurda" target="_blank">TWITTER</a>
      <a href="https://t.me/monadiocartel" target="_blank">CHAT</a>
      <a href="https://monadio.club" target="_blank">CHECK PRICE</a>
    </nav>
  </div>
</section>

<!-- MINT POPUP -->
<div class="mint-overlay" id="mintOverlay">
  <div class="mint-popup">
    <div class="close-popup" id="closeMint">×</div>

    <div class="popup-title">MINT</div>
    <div class="popup-sub">CONNECT WALLET AND CHOOSE AMOUNT</div>

    <div class="popup-row">
      <span class="popup-label">AMOUNT</span>
      <div class="amount-controls">
        <button class="amount-btn" id="minusBtn">−</button>
        <span class="amount-value" id="mintAmount">1</span>
        <button class="amount-btn" id="plusBtn">+</button>
      </div>
    </div>

    <div class="popup-row">
      <span class="popup-label">TOTAL</span>
      <span id="totalPrice">1111.0000 MON</span>
    </div>

    <div class="popup-row">
      <span class="popup-label">WALLET</span>
      <span id="walletAddr">NOT CONNECTED</span>
    </div>

    <button class="button-primary connect-btn" id="connectWallet">CONNECT</button>
    <button class="button-primary" id="mintNow" disabled>MINT NOW</button>
    <button class="button-primary wl-btn" id="freeMintBtn" disabled>FREE MINT (WL ONLY)</button>

    <div class="contract-line">
      CONTRACT:
      <a href="https://monadvision.com/address/0xba26bA63d31D284095F38f0B107DE802e1268Fcf"
         target="_blank">0xba26...8Fcf</a>
    </div>

    <div class="mint-status" id="mintStatus"></div>
  </div>
</div>

<!-- ethers.js -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<script>
  // ====== CONFIG ======

  const CONTRACT_ADDRESS = "0xba26bA63d31D284095F38f0B107DE802e1268Fcf";

  const CONTRACT_ABI = [
    "function mint(uint256 _mintAmount) payable",
    "function cost() view returns (uint256)",
    "function freeMint() external"
  ];

  const MONAD_CHAIN_ID_HEX = "0x8f"; // 143 mainnet
  const MONAD_PARAMS = {
    chainId: MONAD_CHAIN_ID_HEX,
    chainName: "Monad Mainnet",
    nativeCurrency: {
      name: "Monad",
      symbol: "MON",
      decimals: 18
    },
    rpcUrls: ["https://rpc.monad.xyz"],
    blockExplorerUrls: ["https://monadvision.com"]
  };

  const FALLBACK_COST_MON = "1111"; // if cost() fails

  // ====== POPUP OPEN/CLOSE ======
  const openMint  = document.getElementById("openMint");
  const closeMint = document.getElementById("closeMint");
  const overlay   = document.getElementById("mintOverlay");

  openMint.addEventListener("click", (e) => {
    e.preventDefault();
    overlay.style.display = "flex";
  });

  closeMint.addEventListener("click", () => {
    overlay.style.display = "none";
  });

  overlay.addEventListener("click", (e) => {
    if (e.target === overlay) overlay.style.display = "none";
  });

  // ====== PROVIDER (MetaMask + Trust Wallet) ======

  function detectEvmProvider() {
    const eth = window.ethereum;
    if (!eth) return null;

    // Multi-provider (EIP-6963 style)
    if (eth.providers && eth.providers.length) {
      // Prefer MetaMask
      const metaMask = eth.providers.find(p => p.isMetaMask);
      if (metaMask) return metaMask;

      // Prefer Trust Wallet next
      const trust = eth.providers.find(p => p.isTrust || p.isTrustWallet);
      if (trust) return trust;

      return eth.providers[0];
    }

    // Single provider
    return eth;
  }

  let evmProvider = null;

  function getProvider() {
    if (!evmProvider) {
      evmProvider = detectEvmProvider();
    }
    return evmProvider;
  }

  // ====== STATE + UI ======
  let amount = 1;
  const MAX_AMOUNT = 11;
  let costWei = ethers.utils.parseEther(FALLBACK_COST_MON);
  let currentAccount = null;

  const plusBtn     = document.getElementById("plusBtn");
  const minusBtn    = document.getElementById("minusBtn");
  const amountEl    = document.getElementById("mintAmount");
  const priceEl     = document.getElementById("totalPrice");
  const walletEl    = document.getElementById("walletAddr");
  const statusEl    = document.getElementById("mintStatus");
  const connectBtn  = document.getElementById("connectWallet");
  const mintBtn     = document.getElementById("mintNow");
  const freeMintBtn = document.getElementById("freeMintBtn");

  function setStatus(msg, type = "") {
    statusEl.textContent = msg;
    statusEl.className = "mint-status" + (type ? " " + type : "");
  }

  function updatePrice() {
    const totalWei = costWei.mul(amount);
    const formatted = ethers.utils.formatEther(totalWei);
    priceEl.textContent = parseFloat(formatted).toFixed(4) + " MON";
  }

  function setAmount(newAmount) {
    if (newAmount < 1) newAmount = 1;
    if (newAmount > MAX_AMOUNT) newAmount = MAX_AMOUNT;
    amount = newAmount;
    amountEl.textContent = amount;
    updatePrice();
  }

  plusBtn.addEventListener("click", () => setAmount(amount + 1));
  minusBtn.addEventListener("click", () => setAmount(amount - 1));

  updatePrice();

  // ====== ERROR PARSING ======
  function parseFriendlyError(err) {
    const nested =
      err?.data?.message ||
      err?.error?.message ||
      err?.message ||
      "";

    let friendly = nested;

    if (nested.includes("Not eligible"))                     friendly = "NOT WHITELISTED / NO FREE MINT";
    if (nested.includes("not for sale yet"))                 friendly = "MINT NOT LIVE YET";
    if (nested.includes("Not enough tokens left to mint"))   friendly = "NOT ENOUGH SUPPLY LEFT";
    if (nested.includes("Not enough tokens available"))      friendly = "SOLD OUT";
    if (nested.includes("max NFT per address exceeded"))     friendly = "PER-WALLET LIMIT HIT";
    if (nested.includes("Value below price"))                friendly = "NOT ENOUGH MON SENT";
    if (nested.includes("mint more than the 11"))            friendly = "MAX 11 PER TX";

    if (!friendly) friendly = "MINT FAILED";
    return friendly;
  }

  // ====== NETWORK HELPERS (Trust Wallet safe) ======
  async function getCurrentChainIdHex(provider) {
    const raw = await provider.request({ method: "eth_chainId" });

    if (typeof raw === "string") {
      if (raw.startsWith("0x") || raw.startsWith("0X")) {
        return raw.toLowerCase();
      }
      const num = Number(raw);
      if (!Number.isNaN(num)) {
        return "0x" + num.toString(16);
      }
      return raw.toLowerCase();
    }

    if (typeof raw === "number") {
      return "0x" + raw.toString(16);
    }

    return String(raw).toLowerCase();
  }

  async function ensureMonadNetwork() {
    const provider = getProvider();
    if (!provider) {
      throw new Error("NO WALLET DETECTED");
    }

    let currentHex;
    try {
      currentHex = await getCurrentChainIdHex(provider);
    } catch (e) {
      console.error(e);
      return;
    }

    if (currentHex === MONAD_CHAIN_ID_HEX.toLowerCase()) {
      return;
    }

    try {
      await provider.request({
        method: "wallet_switchEthereumChain",
        params: [{ chainId: MONAD_CHAIN_ID_HEX }]
      });
    } catch (switchError) {
      if (switchError.code === 4902) {
        try {
          await provider.request({
            method: "wallet_addEthereumChain",
            params: [MONAD_PARAMS]
          });
        } catch (addError) {
          console.error(addError);
          throw new Error("PLEASE SWITCH NETWORK TO MONAD (CHAIN 143) IN YOUR WALLET");
        }
      } else {
        console.error(switchError);
        throw new Error("PLEASE SWITCH NETWORK TO MONAD (CHAIN 143) IN YOUR WALLET");
      }
    }
  }

  // ====== WALLET CONNECT ======
  async function connectWallet() {
    const provider = getProvider();
    if (!provider) {
      setStatus("NO WALLET DETECTED (OPEN FROM HTTPS SITE, NOT FILE://)", "error");
      return;
    }

    try {
      await ensureMonadNetwork();

      const accounts = await provider.request({
        method: "eth_requestAccounts"
      });

      currentAccount = accounts[0];
      walletEl.textContent = currentAccount;
      connectBtn.textContent = "CONNECTED";
      mintBtn.disabled = false;
      freeMintBtn.disabled = false;
      setStatus("CONNECTED", "success");

      // read on-chain cost
      try {
        const web3Provider = new ethers.providers.Web3Provider(provider);
        const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, web3Provider);
        const onChainCost = await contract.cost();
        if (onChainCost.gt(0)) {
          costWei = onChainCost;
          updatePrice();
        }
      } catch (e) {
        // ignore, fallback stays
      }
    } catch (err) {
      console.error(err);
      setStatus(err.message || "FAILED TO CONNECT", "error");
    }
  }

  connectBtn.addEventListener("click", connectWallet);

  // ====== PAID MINT ======
  async function mint() {
    const provider = getProvider();
    if (!provider) {
      setStatus("NO WALLET DETECTED", "error");
      return;
    }
    if (!currentAccount) {
      setStatus("CONNECT FIRST", "error");
      return;
    }

    try {
      await ensureMonadNetwork();

      const web3Provider = new ethers.providers.Web3Provider(provider);
      const signer   = web3Provider.getSigner();
      const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

      const value = costWei.mul(amount); // cost * _mintAmount

      setStatus("SENDING TRANSACTION…");
      mintBtn.disabled = true;
      freeMintBtn.disabled = true;

      const tx = await contract.mint(amount, { value });
      setStatus("WAITING FOR CONFIRMATION…");
      await tx.wait();

      setStatus("MINT SUCCESSFUL", "success");
      mintBtn.disabled = false;
      freeMintBtn.disabled = false;
    } catch (err) {
      console.error(err);
      mintBtn.disabled = false;
      freeMintBtn.disabled = false;
      if (err.code === 4001) {
        setStatus("TX REJECTED BY USER", "error");
      } else {
        setStatus(parseFriendlyError(err), "error");
      }
    }
  }

  mintBtn.addEventListener("click", mint);

  // ====== FREE MINT (WL ONLY) ======
  async function freeMint() {
    const provider = getProvider();
    if (!provider) {
      setStatus("NO WALLET DETECTED", "error");
      return;
    }
    if (!currentAccount) {
      setStatus("CONNECT FIRST", "error");
      return;
    }

    try {
      await ensureMonadNetwork();

      const web3Provider = new ethers.providers.Web3Provider(provider);
      const signer   = web3Provider.getSigner();
      const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

      setStatus("SENDING FREE MINT TX…");
      mintBtn.disabled = true;
      freeMintBtn.disabled = true;

      const tx = await contract.freeMint(); // no value
      setStatus("WAITING FOR CONFIRMATION…");
      await tx.wait();

      setStatus("FREE MINT SUCCESSFUL", "success");
      mintBtn.disabled = false;
      freeMintBtn.disabled = false;
    } catch (err) {
      console.error(err);
      mintBtn.disabled = false;
      freeMintBtn.disabled = false;
      if (err.code === 4001) {
        setStatus("TX REJECTED BY USER", "error");
      } else {
        setStatus(parseFriendlyError(err), "error");
      }
    }
  }

  freeMintBtn.addEventListener("click", freeMint);

  // ====== REACT TO ACCOUNT CHANGES ======
  const baseProvider = getProvider();
  if (baseProvider && baseProvider.on) {
    baseProvider.on("accountsChanged", (accounts) => {
      if (!accounts.length) {
        currentAccount = null;
        walletEl.textContent = "NOT CONNECTED";
        mintBtn.disabled = true;
        freeMintBtn.disabled = true;
        connectBtn.textContent = "CONNECT";
      } else {
        currentAccount = accounts[0];
        walletEl.textContent = currentAccount;
        mintBtn.disabled = false;
        freeMintBtn.disabled = false;
        connectBtn.textContent = "CONNECTED";
      }
    });
  }
</script>
</body>
</html>
